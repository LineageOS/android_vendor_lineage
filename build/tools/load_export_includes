#!/usr/bin/python

import os
import sys

import prebuilt_utils

# Save previously built object information in cache.
#
# Usage:
#   save_prebuilt <cache_dir> <intermediates_dir>
#
# Note we assume (and require) the following:
#
# (1) There is only one module per cache directory and build directory.

cache_product_out_dir = sys.argv[1]
product_out_dir = sys.argv[2]
cache_dir = sys.argv[3]
intermediates_dir = sys.argv[4]

cache_export_pathname = "%s/export_includes" % (cache_dir)

intermediates_export_pathname = "%s/export_includes" % (intermediates_dir)

dirs = prebuilt_utils.read_includes_file(cache_export_pathname)
for dir in dirs:
    if not dir.startswith(product_out_dir):
        continue
    dst = dir
    src = "%s/%s" % (cache_product_out_dir, dst[len(product_out_dir)+1:])
    prebuilt_utils.lcopytree(src, dst, '*.h')

prebuilt_utils.lcopyfile(cache_export_pathname, intermediates_export_pathname)
